<div class="container mx-auto px-4 max-w-7xl">
  <form [formGroup]="roundForm">
    <!-- utilize grid insead of flexbox as we know the layout of the form -->
    <div
      formArrayName="roundInputsArray"
      class="grid grid-cols-[auto_auto_auto_auto_auto_auto] gap-8"
    >
      <div
        *ngFor="let round of roundInputsArray.controls; let roundCount = index"
        [formGroupName]="roundCount"
        class="contents"
      >
        <!-- Round number -->
        <div class="flex flex-col items-center justify-end">
          <label
            attr.for="{{ 'round_number' + roundCount }}"
            class="whitespace-nowrap font-bold"
            >Round Number: {{ roundCount + 1 }}</label
          >
        </div>

        <!-- 9 or 18 hole selection -->
        <ng-container formGroupName="roundSelectionGroup">
          <div class="flex flex-col">
            <label class="font-bold mb-2.5">Round Selection:</label>
            <div class="flex gap-4">
              <label
                attr.for="{{ 'nineHoles' + roundCount }}"
                class="flex items-center gap-1"
              >
                <input
                  type="radio"
                  id="{{ 'nineHoles' + roundCount }}"
                  [value]="9"
                  formControlName="roundSelection"
                />
                9 Holes
              </label>
              <label
                attr.for="{{ 'eighteenHoles' + roundCount }}"
                class="flex items-center gap-1"
              >
                <input
                  type="radio"
                  id="{{ 'eighteenHoles' + roundCount }}"
                  [value]="18"
                  formControlName="roundSelection"
                />
                18 Holes
              </label>
            </div>
          </div>
        </ng-container>

        <!-- round score input -->
        <div>
          <label
            attr.for="{{ 'userRoundScore' + roundCount }}"
            class="font-bold"
            >Round Score:</label
          >
          <input
            class="w-full ring ring-gray-400 focus:ring-2 focus:ring-blue-500 rounded px-2 py-1"
            id="{{ 'userRoundScore' + roundCount }}"
            type="number"
            formControlName="userRoundScore"
          />
          <div class="text-red-600 font-bold">
            <span *ngIf="round.get('userRoundScore')?.errors?.['invalidForm']">
              Enter in a round of at least
              {{
                round.get("roundSelectionGroup")?.get("roundSelection")
                  ?.value === 18
                  ? "18"
                  : "9"
              }}
            </span>
            <span
              *ngIf="round.get('userRoundScore')?.errors?.['maxScoreExceeded']"
            >
              Maximum score allowed is 200
            </span>
          </div>
        </div>

        <!-- course rating input -->
        <div>
          <label attr.for="{{ 'courseRating' + roundCount }}" class="font-bold"
            >Course Rating:</label
          >
          <input
            class="w-full ring ring-gray-400 focus:ring-2 focus:ring-blue-500 rounded px-2 py-1"
            id="{{ 'courseRating' + roundCount }}"
            type="number"
            formControlName="courseRating"
          />
        </div>

        <!-- slope rating input -->
        <div>
          <label attr.for="{{ 'slopeRating' + roundCount }}" class="font-bold"
            >Slope Rating:</label
          >
          <input
            class="w-full ring ring-gray-400 focus:ring-2 focus:ring-blue-500 rounded px-2 py-1"
            id="{{ 'slopeRating' + roundCount }}"
            type="number"
            formControlName="slopeRating"
          />
        </div>

        <!-- Score Differential -->
        <div>
          <div class="font-bold mb-2.5">Score Differential:</div>
          <div
            class="text-center"
            [ngClass]="{
              'text-green-600':
                (roundScoreDifferentialArray[roundCount] || 0) <= 0,
              'text-red-600': (roundScoreDifferentialArray[roundCount] || 0) > 0
            }"
          >
            {{ roundScoreDifferentialArray[roundCount] || 0 }}
          </div>
        </div>
      </div>
    </div>

    <!-- Total Holes Played -->
    <div class="mt-8 text-center mx-auto">
      <p>
        Total holes played:
        <span class="font-bold text-green-600">{{ totalHolesPlayed }}</span>
      </p>
      <p>
        Total TRUE rounds of 18 holes played:
        <span class="font-bold text-green-600">{{ totalRoundsPlayed }}</span>
      </p>
      <p>
        Holes Left until max:
        <span class="font-bold text-green-600">{{
          maxHolesAllowed - totalHolesPlayed == -9
            ? "Max Holes Exceeded"
            : maxHolesAllowed - totalHolesPlayed
        }}</span>
      </p>
      <p *ngIf="maxHolesExceeded" class="text-red-600 font-bold">
        You can NOT enter an 18 hole score as it will put you over the max
        number of holes which is {{ maxHolesAllowed }} holes
      </p>
    </div>

    <!-- Buttons -->
    <div class="mt-4 space-y-4 flex flex-col items-center mx-auto">
      <button
        (click)="addRound()"
        [disabled]="!roundForm.valid || totalHolesPlayed >= maxHolesAllowed"
        class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed"
      >
        Add Round
      </button>
      <button
        (click)="removeRound()"
        class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600"
      >
        Remove Last Round
      </button>
      <button
        (click)="resetAllRounds()"
        class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"
      >
        Reset Form
      </button>
      <button
        (click)="calculateHandicapBtnClick()"
        [disabled]="calcBtnEnabled || !roundForm.valid || totalHolesPlayed < 54"
        class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed"
      >
        Calculate Handicap
      </button>
    </div>

    <!-- Handicap Index -->
    <div class="mt-8 mb-36 text-center">
      <p *ngIf="!calcBtnEnabled && handicapIndex !== 0" class="text-blue-600">
        {{ recalcHandicapMsg }}
      </p>
      <p class="text-5xl font-bold mt-6">
        Your Handicap Index:
        <span
          [ngClass]="
            handicapIndex === 0
              ? ''
              : handicapIndex > 0
              ? 'text-red-600'
              : 'text-green-600'
          "
        >
          {{ handicapIndex }}
        </span>
      </p>
    </div>
  </form>
</div>
